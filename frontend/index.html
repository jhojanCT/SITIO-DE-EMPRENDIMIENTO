<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Empresa de Tecnología</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <meta name="description" content="Tienda de tecnología con servicios y componentes para mejorar tu experiencia digital.">
  <meta name="keywords" content="tecnología, servicios, componentes, PC">
</head>
<body>

  <header>
    <div class="container">
      <h1>Bienvenido a Tu Tienda de Tecnología</h1>
      <p>Descubre los mejores productos y servicios para tu PC. ¡Haz crecer tu experiencia digital con nosotros!</p>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="tabs">
        <button class="tab-button active" data-tab="services">Servicios</button>
        <button class="tab-button" data-tab="components">Componentes</button>
      </div>

      <section id="services" aria-labelledby="services-heading">
        <h2 id="services-heading">Nuestros Servicios</h2>
        <p>Ofrecemos los siguientes servicios para mantener tu PC en óptimas condiciones:</p>
        <ul id="services-list">
          <li>Soporte Técnico de PC</li>
          <li>Optimización de Sistemas</li>
          <li>Venta de Componentes</li>
        </ul>
      </section>

      <section id="add-service" aria-labelledby="add-service-heading">
        <h2 id="add-service-heading">Añadir Nuevo Servicio</h2>
        <form id="service-form" enctype="multipart/form-data">
          <div class="form-group">
            <label for="service-name">Nombre del Servicio:</label>
            <input type="text" id="service-name" name="service-name" placeholder="Ejemplo: Reparación de Laptop" required>
          </div>
          
          <div class="form-group">
            <label for="service-description">Descripción:</label>
            <textarea id="service-description" name="service-description" placeholder="Describe el servicio" required></textarea>
          </div>

          <div class="form-group">
            <label for="service-image">Subir Imagen del Servicio:</label>
            <input type="file" id="service-image" name="image" accept="image/*" required>
          </div>
          
          <button type="submit">Añadir Servicio</button>
        </form>
      </section>

      <section id="search-service" aria-labelledby="search-service-heading">
        <h2 id="search-service-heading">Buscar Servicios</h2>
        <p>Encuentra rápidamente un servicio que necesites:</p>
        <input type="text" id="search-bar" placeholder="Buscar servicio..." aria-label="Buscar servicios">
        <ul id="search-results">
   
        </ul>
      </section>

    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2024 Empresa de Tecnología. Todos los derechos reservados.</p>
      <p>Contacto: <a href="mailto:contacto@tecnologia.com">contacto@tecnologia.com</a></p>
      <nav>
        <ul>
          <li><a href="#services">Servicios</a></li>
          <li><a href="#add-service">Añadir Servicio</a></li>
          <li><a href="#search-service">Buscar</a></li>
        </ul>
      </nav>
    </div>
  </footer>

  <script>
    // Redirección a login si no hay authToken
    if (!localStorage.getItem('authToken')) {
      window.location.href = 'login.html';
    }

    // Mostrar u ocultar las pestañas
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetTab = this.getAttribute('data-tab');
        
        tabButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');

        tabContents.forEach(content => {
          content.style.display = content.id === targetTab ? 'block' : 'none';
        });
      });
    });

    // Función para cargar los servicios desde la API
    async function loadServices() {
      const servicesList = document.getElementById('services-list');
      servicesList.innerHTML = '<p>Cargando servicios...</p>';

      try {
        const response = await fetch('http://localhost:3000/api/services');
        const services = await response.json();
        
        servicesList.innerHTML = '';
        services.forEach(service => {
          const li = document.createElement('li');
          li.innerHTML = `
            <h3>${service.name}</h3>
            <img src="${service.image_url}" alt="${service.name}" class="service-image">
            <p>${service.description}</p>
            <button onclick="deleteService('${service.id}')">Eliminar</button>
          `;
          servicesList.appendChild(li);
        });
      } catch (error) {
        servicesList.innerHTML = '<p>Error al cargar los servicios. Por favor, intenta de nuevo más tarde.</p>';
        console.error('Error al cargar los servicios:', error);
      }
    }

    // Función para cargar los componentes desde la API
    async function loadComponents() {
      const componentsList = document.getElementById('components-list');
      componentsList.innerHTML = '<p>Cargando componentes...</p>';

      try {
        const response = await fetch('http://localhost:3000/api/components');
        const components = await response.json();
        
        componentsList.innerHTML = '';
        components.forEach(component => {
          const li = document.createElement('li');
          li.innerHTML = `
            <h3>${component.name}</h3>
            <img src="${component.image_url}" alt="${component.name}" class="component-image">
            <p>${component.description}</p>
            <button onclick="deleteComponent('${component.id}')">Eliminar</button>
          `;
          componentsList.appendChild(li);
        });
      } catch (error) {
        componentsList.innerHTML = '<p>Error al cargar los componentes. Por favor, intenta de nuevo más tarde.</p>';
        console.error('Error al cargar los componentes:', error);
      }
    }

    // Función para manejar el envío del formulario de servicios
    document.getElementById('service-form').addEventListener('submit', async function(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const message = document.getElementById('form-message');

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData
        });

        if (response.ok) {
          message.textContent = 'Servicio añadido exitosamente.';
          message.style.color = 'green';
          form.reset();
          loadServices();
        } else {
          throw new Error('Error al añadir el servicio.');
        }
      } catch (error) {
        message.textContent = error.message;
        message.style.color = 'red';
      }
    });

    // Función para manejar el envío del formulario de componentes
    document.getElementById('component-form').addEventListener('submit', async function(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const message = document.getElementById('component-form-message');

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData
        });

        if (response.ok) {
          message.textContent = 'Componente añadido exitosamente.';
          message.style.color = 'green';
          form.reset();
          loadComponents();
        } else {
          throw new Error('Error al añadir el componente.');
        }
      } catch (error) {
        message.textContent = error.message;
        message.style.color = 'red';
      }
    });

    // Función para eliminar un servicio
    async function deleteService(id) {
      const response = await fetch(`http://localhost:3000/api/services/${id}`, {
        method: 'DELETE',
      });

      if (response.ok) {
        loadServices();
      } else {
        alert('Error al eliminar el servicio');
      }
    }
ç
async function deleteService(id) {
  const token = localStorage.getItem('authToken');
  console.log('Token:', token); // Verifica que el token no esté vacío o nulo

  if (!token) {
    alert('No se ha encontrado un token de autenticación.');
    return;
  }

  const response = await fetch(`http://localhost:3000/api/services/${id}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${token}`, // Incluye el token en los headers
    },
  });

  if (response.ok) {
    loadServices();
  } else {
    alert('Error al eliminar el servicio');
  }
}
    // Función para eliminar un componente
async function deleteComponent(id) {
  const token = localStorage.getItem('authToken');
  console.log('Token:', token); // Verifica que el token no esté vacío o nulo

  if (!token) {
    alert('No se ha encontrado un token de autenticación.');
    return;
  }

  const response = await fetch(`http://localhost:3000/api/components/${id}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${token}`, // Incluye el token en los headers
    },
  });

  if (response.ok) {
    loadComponents(); // Llama a una función para recargar la lista de componentes después de eliminar
  } else {
    alert('Error al eliminar el componente');
  }
}



    // Cargar servicios y componentes al inicio
    window.addEventListener('DOMContentLoaded', function() {
      loadServices();
      loadComponents();
    });
  </script> 

</body>
</html>
